---
publish: true
title: "6ピンRGBファンをマザボから制御できるようにしてみた"
publishDate: 2024-09-07 10:45:00 +09:00
description: "EZDIY-FABの6ピンRGBファンをマザーボードから制御できるようにするためのファンハブを自作した話。"
---

以前サーバ用PCを静音化したが、相対的にメインPCがうるさいことに気づいた。メインPCのケースファンにはEZDIY-FABのRGBファンが使われている。通常の3-4ピンファンではなく6ピンで、専用のハブに接続してリモコンでファン速度と色を変更できるよくあるやつ。しかしながら、リモコンを紛失したうえ、いろいろいじっていたらハブを破壊してしまった(短絡したかなにかでヒューズが逝ってた)。そこで、マザーボードから通常のファンのようにPWM制御でき、色もマザーボードからARGBで制御できる、もとより便利なファンハブを自作してみた。

## ファンの仕様

ピンアサインはハブの基板に印字があり、以下のようになっていた。別のメーカーでもだいたい同じっぽいが、違うところもあるので注意。

| ピン | 機能 |
| --- | --- |
| 1 | +12V |
| 2 | GND(ファン) |
| 3 | GND(LED) |
| 4 | RGB IN |
| 5 | +5V |
| 6 (ケーブル側黒線) | RGB OUT |

PWM入力はないため、ファンに与える電圧を変えることでファン速度を制御する必要がある。回転数出力はない。

また、RGBにはINとOUTがあるが、これはアドレサブルRGB(ARGB)のデイジーチェーンに対応している。ARGBではRGBの値を連続で送信し、個々のLEDが先頭の値を読み取って色を変え、残りの部分をそのまま次のLEDに流すことでデイジーチェーンを実現している。

コネクタは2 mmピッチで、おそらくPHコネクタだと思われる。

## ファン制御

マザーボードが電圧による制御に対応していれば直結するだけでよいのだが、あいにくPWM制御しか対応していないので、PWM信号を受け取って電圧を変動させる必要がある。

ブラシレスDCモータではあるが、普通のDCモータのようにPWMで疑似的に電圧を上下させることでとりあえず制御できるっぽい。無難にMOSFETでローサイドスイッチングする。ファンとLEDとでGNDが分けられている(というか印字は「F」だった)あたり、もとのハブでもおそらく同じことをしている。なお、回転数出力のある通常の3ピンファンをローサイドスイッチングすると、[回転数出力がおしまいになる](https://twitter.com/DG_7D/status/1824070668394107222)ので注意。オープンコレクタ出力らしいのでハイサイドスイッチングすれば使えるはず。

もとのハブでは電源をSATA電源から取っていたが、1基あたり0.23 A(と書いてあるが実際は0.15 Aくらい)しか消費しないものを4基しかつながないので、普通にマザーボードのファン端子(取説によれば1 Aまで可)から取ることにした。

Intelの仕様書(後述)によれば、マザーボードのPWM信号はオープンコレクタで、ファン側でプルアップしろとされている。3.3 V推奨で5.25 Vまで許されるらしい。5 VならRGB側に来ているが、ファンの12 Vだけでも使えるようにしたいので、どうにかしてプルアップの電圧を作る必要がある。DCDCコンバータで3.3Vを生み出すのが確実だが、ただプルアップするだけにはちょっと大げさなので、単純に抵抗で分圧することにした。短絡せずに電圧が変わりさえすればいいので、これでも問題ないはずである。10 kΩと4.7 kΩでだいたい3.8 Vを作った。常時電流が流れて電力が消費されてしまうが、10 mWくらいはファンの電力に比べたら誤差。

ちっちゃくて2.5Vでオンになってくれる[都合のいいMOSFET](https://akizukidenshi.com/catalog/g/g115851/)が転がっていたので、信号をそのままゲートにぶち込んでやれば完成。ファンの中にあるっぽいのでたぶん不要だが、還流ダイオードをお守りでつけておく。

## RGB制御

もとのハブではRGBの電源もSATAから取っていたが、1基あたり8つのLEDがついてるものを4基の計32個しかつながないので、これもマザーボードのARGB端子(75個まで可)から取ることにした。信号はマザーボードからのを1つめのファンのみに繋ぎ、そのOUTを次のINに繋ぐことを繰り返せばよい。

## 基板にまとめる

ブレッドボードで動作確認した後、ユニバーサル基板上にまとめた。出力コネクタは壊れたもとのハブから抜き取った(L字のをまっすぐにするのが大変だった)。こっちのピッチは2 mmだが、入力はマザーボードと同じく2.54 mmとしたいので、両方を混載できる[2.54 mm x 2 mmピッチ基板](https://akizukidenshi.com/catalog/g/g110434/)を使った。はんだ付けnoobに2 mmピッチはしんどかった。

<Tweet id="1831487215400357913" hideThread />
<Tweet id="1830603640006213971" hideThread />
<Tweet id="1831236650133053706" hideThread />

## 使う

実際に接続して使ってみた。個体差があるが、このファンは40%あれば始動できる模様。仕様を満たすには30%で始動できなければならないが仕方ない。回転数は得られないのでファンが回っているかどうかは目視で確かめなければならない(蓋が透明のケースでよかった)。ファン自体は流体軸受だったり防振ゴムがついていたりして全速でも比較的静かではあったが、回転数を落とせると風の音も低減できて非常によい。通常のファンはデューティー比を0%にしても停止してくれない(するものもある)が、こいつは全域でデューティー比に従おうとするので、再始動に必要な電圧に注意すれば、セミファンレス運用も可能である。もともとPWM制御に対応しているファンであっても、停止できるようにこの回路を噛ます手があるかもしれない。

ファンの制御は[Fan Control](https://getfancontrol.com/)を使ってみた。wingetからインストールできる。始動電圧と停止電圧を設定でき、停止状態から始動電圧を下回る指示に移行したときに、一定時間(2秒間?)始動電圧を出力する機能があるので、このような場合にも対応できる。

RGBはもともとなくてもよかったのだが、せっかくついてて使えるようにしたので、とりあえずかわいい色でぼんやり光らせておいた。単色なのでデイジーチェーンは活かせていないが、使おうと思えば使えるというところに意味がある。

<Tweet id="1831321814347477010" hideThread />

## 付録: Intelの4ピンファンの仕様まとめ

### 電気的仕様

<dl class="inline">
    <dt>電源</dt><dd>12 ±5% V</dd><dd>定常最大 1.5 A</dd><dd>瞬間最大 2.2 A (1秒間)</dd>
    <dt>回転数出力</dt><dd>2パルス/回転</dd><dd>オープンコレクタ</dd><dd>マザーボード側は12 Vプルアップ</dd>
    <dt>PWM入力</dt><dd>25 -4 +3 kHz</dd><dd>LOW入力電圧 0.8 V</dd><dd>最大電流 5 mA</dd><dd>最大5.25 Vでプルアップ(3.3 Vを強く推奨)</dd><dd>マザーボード側はオープンコレクタ</dd>
</dl>

### PWM制御

- デューティー比100%で最大回転数
- 最低回転数は最大回転数の30%以下、この回転数で始動しなければならない
- 最低回転数以上では 回転数 / 最大回転数 = デューティー比±10%
- 最低回転数未満では 回転数 \<= 最低回転数。最低回転数を維持したり、0%では止まるようにしたり、モータが損傷しない範囲でデューティー比に従ったりなどが推奨
- 最低回転数未満では始動のため最大30%で最長2秒間回転させてよい

そのほかは[原本](https://www.intel.com/content/dam/support/us/en/documents/intel-nuc/intel-4wire-pwm-fans-specs.pdf)を参照

## あとがき

同じメーカーの似たようなファンで、もとから[PWM制御できるバージョン](https://ezdiy-fab.com/collections/gaming-case-fan-series/products/white-moonlight-120mm-rgb-case-fan-with-pwm-fan-hub)もあるらしい(絵からして回転数出力はなさそう)。これは自分で組んだPCではないのだが、全速で固定というならまだしも、中途半端にリモコンだけ対応しているハブを売る意味も選ぶ意味も分からない。ゲームをするときはリモコンで回転数を上げて、終わったら戻して、みたいな運用をする人類が実在しているのだろうか……。