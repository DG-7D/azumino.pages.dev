---
publish: false
title: "ESP32で任意の赤外線リモコン信号を投げられるサーバを作ってみた"
publishDate: 9999-12-31 00:00:00 +09:00
description: "せつめい"
---

人間が生存可能な空間を生成するためにはエアコンが欠かせないわが国であるが、長時間出かけるときにもつけっぱなしというわけにはいかない。しかし、帰宅してから電源を入れていては、部屋が人間の存在できる環境になるまでに時間がかかってしまう。帰宅時間がある程度予測できるのならタイマを設定しておけばよいが、遊び呆けている大学生の帰宅時間は予測不能である。イマドキのエアコンであれば、インターネットに繋がっていて外出先からアプリで操作できるようなものもあるが、自室で使っているエアコンは最低限の機能のもので、そんな大層な機能はついていない。

ESP32には、Remote Control Transceiver (RMT)という赤外線リモコン信号の送受信に特化したモジュールが搭載されている。

## PlatformIOで最新のArduino-ESP32を使う

ところで、ESP32ではArduino-ESP32というArduinoと同じようにプログラムを書くことができるフレームワークが公式に提供されている。Arduino互換の機能だけでなく、RMTなどESP32固有の機能も抽象化して簡単に使えるようになっている。

Arduino-ESP32はより低いレイヤのフレームワークであるESP-IDFをベースにしているが、ESP-IDFにおけるRMTの扱いがv5.5.0で変更されており、Arduino-ESP32もそれに追従している。

また、Arduino環境は主にArduino IDEというArduino公式の開発環境で使われることを想定されているが、PlatformIOというより強力な開発環境でも、公式やESP32向けのフレームワークを利用することができる。PlatformIOでArduino向けのフレームワークを利用するためには橋渡しをするための定義ファイルが必要で、かつてはEspressif公式から提供されていたが、関係の悪化から更新が止まってしまっていた。このときのバージョンはESP-IDF v4.4.7ベースのArduino-ESP32 v2.0.17であり、RMTのAPIは古いものになっている。新しいArduino-ESP32を使うためには、コミュニティが提供する定義ファイルを利用する必要がある。

PlatformIO
`platform = arduino` → Arduino-ESP32 v2.0.17 (ESP-IDF v4.4.7ベース) → Arduino版旧RMT (旧RMTベース) ドキュメントおしまい
`platform = espidf` → ESP-IDF v5.5.0 (新RMT)
`platform = arduino, espidf` → ESP-IDFが3.4に??? → 旧RMT

Arduino版新RMT realTickなし Carrierまとも

https://note.com/ndenki/n/n35bb7a41bbd8