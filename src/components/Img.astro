---
import { getImage } from "astro:assets";

interface Props {
    src: ImageMetadata;
    alt: string;
    widths?: number[];
    caption?: string;
}

const optimizedImage = await getImage({
    src: Astro.props.src,
    alt: Astro.props.alt,
    widths: Astro.props.widths ?? [1920, 960],
});
---

<figure>
    <a href={optimizedImage.src} target="_blank">
        <img src={optimizedImage.src} srcset={optimizedImage.srcSet.attribute} {...optimizedImage.attributes} />
    </a>
    {Astro.props.caption && <figcaption>{Astro.props.caption}</figcaption>}
</figure>
<style lang="scss">
    figure {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5em;

        a {
            display: block;
            border: 0.1rem solid var(--main-shadow);
            &:hover {
                border-color: var(--main-color);
            }
        }
        img {
            display: block;
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 50vh;
        }
        figcaption {
            display: block;
        }
    }
</style>
